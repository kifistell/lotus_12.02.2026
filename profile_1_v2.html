<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü—Ä–æ—Ñ–∏–ª—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ ‚Ä¢ –í–ö–û</title>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å–∞–π—Ç–∞ (—Ç–µ–º—ã + –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã) -->
  <link rel="stylesheet" href="quide_1.css" />

  <link rel="stylesheet" href="profile_1_v2.css" />

</head>

<body>
  <!-- Top bar -->
  <div class="pp-topbar">
    <div class="container">
      <div class="pp-brand">
        <!-- –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≤–∞—à lotus.png. –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å. -->
        <img class="pp-logo" src="lotus.png" alt="–õ–æ–≥–æ—Ç–∏–ø" onerror="this.style.display='none'" />
        <div>
          <h1>–ü—Ä–æ—Ñ–∏–ª—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞</h1>
          <p>–í–æ—Å—Ç–æ—á–Ω—ã–π –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω ‚Ä¢ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
        </div>
      </div>

      <div class="pp-nav">
        <a class="pp-link" href="index_personalized.multistop.html" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <button class="profile-btn" id="themeToggle" type="button">–¢–µ–º–∞</button>
      </div>
    </div>
  </div>

  <main class="pp-screen">
    <div class="pp-grid">
      <!-- LEFT: Builder -->
      <section class="pp-card" aria-labelledby="ppMainTitle">
        <div class="pp-card-head">
          <div>
            <div class="pp-kicker">–º–∏–Ω–∏-–∞–Ω–∫–µ—Ça</div>
            <h2 class="pp-title" id="ppMainTitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–¥ –≤–∞—à —Å—Ç–∏–ª—å</h2>
            <p class="pp-sub">
              –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å, —É—Ä–æ–≤–µ–Ω—å, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤
              <strong>localStorage.userProfile</strong> –∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
            </p>
          </div>

          <div class="pp-actions">
            <button class="profile-btn" id="ppSave" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="profile-btn ghost" id="ppReset" type="button">–°–±—Ä–æ—Å</button>
          </div>
        </div>

        <div class="pp-body">
          <!-- Contact / profile details -->
          <div class="pp-section" aria-labelledby="ppUser">
            <h3 id="ppUser">0) –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è <span class="pp-kicker" style="margin:0; opacity:.8;">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></h3>
            <p class="pp-hint">–ò–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –≤–∞—à–∏–º –≤—ã–±–æ—Ä–æ–º –∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏/–æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.</p>

            <div class="pp-form" role="group" aria-label="–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ">
              <div class="pp-field">
                <label for="ppName">–ò–º—è</label>
                <input class="pp-input" id="ppName" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∏—Ä–∏–ª–ª" autocomplete="name" />
              </div>

              <div class="pp-field">
                <label for="ppPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input class="pp-input" id="ppPhone" type="tel" placeholder="+7 ..." autocomplete="tel" inputmode="tel" />
              </div>

              <div class="pp-field">
                <label for="ppEmail">–ü–æ—á—Ç–∞</label>
                <input class="pp-input" id="ppEmail" type="email" placeholder="name@example.com" autocomplete="email" inputmode="email" />
              </div>

              <div class="pp-field">
                <label for="ppTelegram">Telegram</label>
                <input class="pp-input" id="ppTelegram" type="text" placeholder="@username (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" autocomplete="off" />
              </div>

              <div class="pp-field full">
                <label for="ppNotes">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                <textarea class="pp-textarea" id="ppNotes" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ö–æ—á—É –º–∞—Ä—à—Ä—É—Ç—ã –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–¥—ä—ë–º–æ–≤, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã —Ä–∞—Å—Å–≤–µ—Ç—ã –∏ –æ–∑—ë—Ä–∞"></textarea>
              </div>
            </div>
          </div>


          <!-- Goal -->
          <div class="pp-section" aria-labelledby="ppGoal">
            <h3 id="ppGoal">1) –¶–µ–ª—å –ø–æ–µ–∑–¥–∫–∏ <span class="pp-kicker" style="margin:0; opacity:.8;">(–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É)</span></h3>
            <p class="pp-hint">–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ: —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, —Å–µ–º—å—è, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ, —Ñ–æ—Ç–æ –∏–ª–∏ —Ä—ã–±–∞–ª–∫–∞.</p>

            <div class="pp-options" role="radiogroup" aria-label="–¶–µ–ª—å –ø–æ–µ–∑–¥–∫–∏">
              <button class="pp-opt" type="button" data-group="goal" data-value="relax" role="radio" aria-checked="false">
                <div class="pp-ico">üßò</div>
                <div><strong>Relax</strong><span>–¢–∏—à–∏–Ω–∞, –ø—Ä–∏—Ä–æ–¥–∞, –∫–æ–º—Ñ–æ—Ä—Ç</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="goal" data-value="family" role="radio" aria-checked="false">
                <div class="pp-ico">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                <div><strong>Family</strong><span>–ë–µ–∑–æ–ø–∞—Å–Ω–æ, —É–¥–æ–±–Ω–æ, –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="goal" data-value="trekking" role="radio" aria-checked="false">
                <div class="pp-ico">ü•æ</div>
                <div><strong>Trekking</strong><span>–¢—Ä–æ–ø—ã, –Ω–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="goal" data-value="photo" role="radio" aria-checked="false">
                <div class="pp-ico">üì∏</div>
                <div><strong>Photo</strong><span>–í–∏–¥–æ–≤—ã–µ —Ç–æ—á–∫–∏, —Ä–∞—Å—Å–≤–µ—Ç—ã, –∫–∞–¥—Ä—ã</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="goal" data-value="fishing" role="radio" aria-checked="false">
                <div class="pp-ico">üé£</div>
                <div><strong>Fishing</strong><span>–í–æ–¥–æ—ë–º—ã, –º–µ—Å—Ç–∞ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏</span></div>
              </button>
            </div>
          </div>

          <!-- Level -->
          <div class="pp-section" aria-labelledby="ppLevel">
            <h3 id="ppLevel">2) –£—Ä–æ–≤–µ–Ω—å <span class="pp-kicker" style="margin:0; opacity:.8;">(–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω)</span></h3>
            <p class="pp-hint">–í–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –∫–∞–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã—à–µ: ¬´–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞¬ª –∏–ª–∏ ¬´—Å–ª–æ–∂–Ω–µ–µ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–Ω–æ¬ª.</p>

            <div class="pp-options cols-2" role="radiogroup" aria-label="–£—Ä–æ–≤–µ–Ω—å">
              <button class="pp-opt" type="button" data-group="level" data-value="beginner" role="radio" aria-checked="false">
                <div class="pp-ico">üôÇ</div>
                <div><strong>Beginner</strong><span>–õ—ë–≥–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã, –º–∏–Ω–∏–º—É–º —Ä–∏—Å–∫–∞</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="level" data-value="medium" role="radio" aria-checked="false">
                <div class="pp-ico">üí™</div>
                <div><strong>Medium</strong><span>–£–º–µ—Ä–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, —Ç—Ä–æ–ø—ã</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="level" data-value="advanced" role="radio" aria-checked="false">
                <div class="pp-ico">üßó</div>
                <div><strong>Advanced</strong><span>–°–ª–æ–∂–Ω–µ–µ, –Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–Ω–æ</span></div>
              </button>
            </div>
          </div>

          <!-- Duration -->
          <div class="pp-section" aria-labelledby="ppDuration">
            <h3 id="ppDuration">3) –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ <span class="pp-kicker" style="margin:0; opacity:.8;">(–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É)</span></h3>
            <p class="pp-hint">–ß—Ç–æ–±—ã –ø–æ–¥–Ω–∏–º–∞—Ç—å –≤–≤–µ—Ä—Ö —Ç–µ –ª–æ–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ —É—Å–ø–µ—Ç—å –∑–∞ –≤–∞—à–µ –≤—Ä–µ–º—è.</p>

            <div class="pp-options cols-2" role="radiogroup" aria-label="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏">
              <button class="pp-opt" type="button" data-group="duration" data-value="1day" role="radio" aria-checked="false">
                <div class="pp-ico">üïí</div>
                <div><strong>1 day</strong><span>–°—ä–µ–∑–¥–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="duration" data-value="weekend" role="radio" aria-checked="false">
                <div class="pp-ico">üìÖ</div>
                <div><strong>Weekend</strong><span>–°–±/–í—Å, –∫–æ—Ä–æ—Ç–∫–∏–π –≤—ã–µ–∑–¥</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="duration" data-value="3to5" role="radio" aria-checked="false">
                <div class="pp-ico">üß≥</div>
                <div><strong>3‚Äì5 days</strong><span>–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–µ–∑–¥–∫–∞</span></div>
              </button>
            </div>
          </div>

          <!-- Transport -->
          <div class="pp-section" aria-labelledby="ppTransport">
            <h3 id="ppTransport">4) –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç <span class="pp-kicker" style="margin:0; opacity:.8;">(–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω)</span></h3>
            <p class="pp-hint">–ü–æ–∫–∞–∂–µ–º —Ç–æ, –∫—É–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –¥–æ–±—Ä–∞—Ç—å—Å—è –≤–∞—à–∏–º —Å–ø–æ—Å–æ–±–æ–º.</p>

            <div class="pp-options cols-2" role="radiogroup" aria-label="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">
              <button class="pp-opt" type="button" data-group="transport" data-value="car" role="radio" aria-checked="false">
                <div class="pp-ico">üöó</div>
                <div><strong>Car</strong><span>–°–≤–æ–±–æ–¥–Ω–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="transport" data-value="public" role="radio" aria-checked="false">
                <div class="pp-ico">üöå</div>
                <div><strong>Public</strong><span>–ê–≤—Ç–æ–±—É—Å/–ø–æ–µ–∑–¥ + –ø–µ—à–∫–æ–º</span></div>
              </button>
              <button class="pp-opt" type="button" data-group="transport" data-value="tour" role="radio" aria-checked="false">
                <div class="pp-ico">üßë‚Äçüè´</div>
                <div><strong>Tour</strong><span>–° –≥–∏–¥–æ–º / –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç—É—Ä</span></div>
              </button>
            </div>
          </div>

          <!-- Interests -->
          <div class="pp-section" aria-labelledby="ppInterests">
            <h3 id="ppInterests">5) –ò–Ω—Ç–µ—Ä–µ—Å—ã <span class="pp-kicker" style="margin:0; opacity:.8;">(–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</span></h3>
            <p class="pp-hint">–ß–µ–º –±–æ–ª—å—à–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º ‚Äî —Ç–µ–º –≤—ã—à–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö.</p>

            <div class="pp-interests" aria-label="–ò–Ω—Ç–µ—Ä–µ—Å—ã">
              <button class="pp-interest" type="button" data-interest="lakes">üèûÔ∏è –û–∑—ë—Ä–∞</button>
              <button class="pp-interest" type="button" data-interest="mountains">‚õ∞Ô∏è –ì–æ—Ä—ã</button>
              <button class="pp-interest" type="button" data-interest="waterfalls">üí¶ –í–æ–¥–æ–ø–∞–¥—ã</button>
              <button class="pp-interest" type="button" data-interest="canyons">ü™® –ö–∞–Ω—å–æ–Ω—ã</button>
              <button class="pp-interest" type="button" data-interest="forests">üå≤ –õ–µ—Å–∞/—Ç–∞–π–≥–∞</button>
              <button class="pp-interest" type="button" data-interest="rivers">üåä –†–µ–∫–∏</button>
              <button class="pp-interest" type="button" data-interest="plateaus">üóª –ü–ª–∞—Ç–æ</button>
              <button class="pp-interest" type="button" data-interest="steppes">üåæ –°—Ç–µ–ø–∏/–ª—É–≥–∞</button>
              <button class="pp-interest" type="button" data-interest="glaciers">‚ùÑÔ∏è –õ–µ–¥–Ω–∏–∫–∏</button>
            </div>

            <div class="pp-small">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤—ã–±–µ—Ä–∏—Ç–µ 2‚Äì4 –∏–Ω—Ç–µ—Ä–µ—Å–∞ ‚Äî —Ç–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç —Ç–æ—á–Ω–µ–µ –∏ –Ω–µ –±—É–¥—É—Ç ¬´—Ä–∞–∑–º—ã—Ç—ã¬ª.</div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Summary -->
      <aside class="pp-side">
        <section class="pp-card">
          <div class="pp-profilebox">
            <div class="pp-avatar" aria-hidden="true">üë§</div>
            <h3  id="ppProfileTitle" >–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
            <div id="ppStatus" class="pp-status warn">‚ö†Ô∏è –ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>

            <div id="ppSummaryChips" class="pp-chips" aria-live="polite"></div>

            <p class="pp-note" id="ppSummaryText">
              –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ <strong>¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª</strong>. –ü–æ—Ç–æ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é ‚Äî –±–ª–æ–∫ ¬´–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∞–º¬ª –Ω–∞—á–Ω—ë—Ç –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è.
            </p>

            <div style="margin-top: 14px; display:flex; gap:10px; flex-wrap:wrap;">
              <a class="pp-link" href="index.html">–û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é</a>
              <button class="profile-btn ghost" id="ppClearOnlyInterests" type="button">–û—á–∏—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã</button>
            </div>
          </div>
        </section>

       
      </aside>
    </div>
  </main>

  <div class="pp-toast" id="ppToast" role="status" aria-live="polite"></div>

  <script>
    // ===== Theme (same behavior as main page) =====
    const themeBtn = document.getElementById("themeToggle");

    function applyThemeFromStorage() {
      if (localStorage.getItem("theme") === "green") {
        document.body.classList.add("green");
      } else {
        document.body.classList.remove("green");
      }
    }

    if (themeBtn) {
      themeBtn.addEventListener("click", () => {
        const isGreen = document.body.classList.toggle("green");
        localStorage.setItem("theme", isGreen ? "green" : "dark");
      });
    }

    applyThemeFromStorage();

    // ===== Profile storage =====
    const STORAGE_KEY = "userProfile";

    const LABELS = {
      goal: {
        relax: "Relax",
        family: "Family",
        trekking: "Trekking",
        photo: "Photo",
        fishing: "Fishing",
      },
      level: {
        beginner: "Beginner",
        medium: "Medium",
        advanced: "Advanced",
      },
      duration: {
        "1day": "1 day",
        weekend: "Weekend",
        "3to5": "3‚Äì5 days",
      },
      transport: {
        car: "Car",
        public: "Public",
        tour: "Tour",
      },
      interests: {
        lakes: "–û–∑—ë—Ä–∞",
        mountains: "–ì–æ—Ä—ã",
        waterfalls: "–í–æ–¥–æ–ø–∞–¥—ã",
        canyons: "–ö–∞–Ω—å–æ–Ω—ã",
        forests: "–õ–µ—Å–∞/—Ç–∞–π–≥–∞",
        rivers: "–†–µ–∫–∏",
        plateaus: "–ü–ª–∞—Ç–æ",
        steppes: "–°—Ç–µ–ø–∏/–ª—É–≥–∞",
        glaciers: "–õ–µ–¥–Ω–∏–∫–∏",
      }
    };

    function safeParse(json) {
      try { return JSON.parse(json); } catch { return null; }
    }

    function getProfile() {
      const raw = localStorage.getItem(STORAGE_KEY);
      const p = raw ? safeParse(raw) : null;
      if (!p || typeof p !== "object") return null;
      return {
        // contact / profile details (optional)
        name: typeof p.name === "string" ? p.name : "",
        phone: typeof p.phone === "string" ? p.phone : "",
        email: typeof p.email === "string" ? p.email : "",
        telegram: typeof p.telegram === "string" ? p.telegram : "",
        notes: typeof p.notes === "string" ? p.notes : "",

        // travel preferences
        goal: p.goal || "",
        level: p.level || "",
        duration: p.duration || "",
        transport: p.transport || "",
        interests: Array.isArray(p.interests) ? p.interests : [],
      };
    }

    function setProfile(p) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(p));
    }

    function clearProfile() {
      localStorage.removeItem(STORAGE_KEY);
    }

    // ===== UI state =====
    const state = {
      // contact / profile details
      name: "",
      phone: "",
      email: "",
      telegram: "",
      notes: "",

      // travel preferences
      goal: "",
      level: "",
      duration: "",
      transport: "",
      interests: new Set(),
      saved: false,
    };

    const $toast = document.getElementById("ppToast");
    const $status = document.getElementById("ppStatus");
    const $chips = document.getElementById("ppSummaryChips");
    const $summary = document.getElementById("ppSummaryText");
    const $profileTitle = document.getElementById("ppProfileTitle");


    // Contact inputs (optional)
    const $name = document.getElementById("ppName");
    const $phone = document.getElementById("ppPhone");
    const $email = document.getElementById("ppEmail");
    const $telegram = document.getElementById("ppTelegram");
    const $notes = document.getElementById("ppNotes");

    function safeSet(el, value) {
      if (!el) return;
      const v = value ?? "";
      if (el.value !== v) el.value = v;
    }

    function syncInputsFromState() {
      safeSet($name, state.name);
      safeSet($phone, state.phone);
      safeSet($email, state.email);
      safeSet($telegram, state.telegram);
      safeSet($notes, state.notes);
    }

    function toast(msg) {
      if (!$toast) return;
      $toast.textContent = msg;
      $toast.classList.add("show");
      window.clearTimeout(toast._t);
      toast._t = window.setTimeout(() => $toast.classList.remove("show"), 1600);
    }

    function updateSelectedUI() {
        syncInputsFromState();
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–º—è –≤–º–µ—Å—Ç–æ "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å"
        if ($profileTitle) {
            const n = (state.name || "").trim();
            $profileTitle.textContent = n ? n : "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å";
        }

      // Single-choice groups
      document.querySelectorAll(".pp-opt[data-group]").forEach(btn => {
        const group = btn.getAttribute("data-group");
        const val = btn.getAttribute("data-value");
        const on = state[group] === val;
        btn.classList.toggle("is-selected", on);
        btn.setAttribute("aria-checked", on ? "true" : "false");
      });

      // Interests
      document.querySelectorAll(".pp-interest[data-interest]").forEach(btn => {
        const tag = btn.getAttribute("data-interest");
        btn.classList.toggle("is-selected", state.interests.has(tag));
        btn.setAttribute("aria-pressed", state.interests.has(tag) ? "true" : "false");
      });

      // Summary chips
      const chips = [];
      // Contact chips (optional)
    
      if (state.phone) chips.push(["–¢–µ–ª–µ—Ñ–æ–Ω", state.phone]);
      if (state.email) chips.push(["Email", state.email]);
      if (state.telegram) chips.push(["Telegram", state.telegram]);
      if (state.goal) chips.push(["–¶–µ–ª—å", LABELS.goal[state.goal] || state.goal]);
      if (state.level) chips.push(["–£—Ä–æ–≤–µ–Ω—å", LABELS.level[state.level] || state.level]);
      if (state.duration) chips.push(["–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", LABELS.duration[state.duration] || state.duration]);
      if (state.transport) chips.push(["–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", LABELS.transport[state.transport] || state.transport]);

      const interests = Array.from(state.interests).map(k => LABELS.interests[k] || k);
      if (interests.length) chips.push(["–ò–Ω—Ç–µ—Ä–µ—Å—ã", interests.join(", ")]);

      $chips.innerHTML = chips.length
        ? chips.map(([k, v]) => `<span class="pp-chip"><em>${k}:</em> ${escapeHTML(v)}</span>`).join("")
        : "<span class=\"pp-note\">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ.</span>";

      // Status
      const complete = Boolean(state.goal && state.level && state.duration && state.transport);
      const hasAny = Boolean(state.name || state.phone || state.email || state.telegram || state.notes || state.goal || state.level || state.duration || state.transport || state.interests.size);

      if (state.saved) {
        $status.className = "pp-status ok";
        $status.textContent = "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
        $summary.innerHTML = complete
          ? "–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–¥—Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ–¥ –≤–∞—à –≤—ã–±–æ—Ä."
          : "–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω, –Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ú–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏.";
      } else {
        $status.className = "pp-status " + (hasAny ? "warn" : "warn");
        $status.textContent = hasAny ? "‚ö†Ô∏è –ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ" : "‚ö†Ô∏è –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ";
        $summary.innerHTML = hasAny
          ? "–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –Ω–æ –µ—â—ë –Ω–µ –Ω–∞–∂–∞–ª–∏ <strong>¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª</strong>."
          : "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ <strong>¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª</strong>.";
      }
    }

    function escapeHTML(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function loadIntoState(p) {
      // contact / profile details
      state.name = p?.name || "";
      state.phone = p?.phone || "";
      state.email = p?.email || "";
      state.telegram = p?.telegram || "";
      state.notes = p?.notes || "";

      // travel preferences
      state.goal = p?.goal || "";
      state.level = p?.level || "";
      state.duration = p?.duration || "";
      state.transport = p?.transport || "";
      state.interests = new Set(Array.isArray(p?.interests) ? p.interests : []);
      state.saved = Boolean(p);

      syncInputsFromState();
    }

    // ===== Event wiring =====
    function wireInput(el, key) {
      if (!el) return;
      el.addEventListener("input", () => {
        state[key] = el.value;
        state.saved = false;
        updateSelectedUI();
      });
    }

    wireInput($name, "name");
    wireInput($phone, "phone");
    wireInput($email, "email");
    wireInput($telegram, "telegram");
    wireInput($notes, "notes");

    document.querySelectorAll(".pp-opt[data-group]").forEach(btn => {
      btn.addEventListener("click", () => {
        const group = btn.getAttribute("data-group");
        const val = btn.getAttribute("data-value");
        // toggle off if clicked again
        state[group] = (state[group] === val) ? "" : val;
        state.saved = false;
        updateSelectedUI();
      });
    });

    document.querySelectorAll(".pp-interest[data-interest]").forEach(btn => {
      btn.addEventListener("click", () => {
        const tag = btn.getAttribute("data-interest");
        if (state.interests.has(tag)) state.interests.delete(tag);
        else state.interests.add(tag);
        state.saved = false;
        updateSelectedUI();
      });
    });

    document.getElementById("ppSave")?.addEventListener("click", () => {
      const profile = {
        // contact / profile details
        name: state.name.trim(),
        phone: state.phone.trim(),
        email: state.email.trim(),
        telegram: state.telegram.trim(),
        notes: state.notes.trim(),

        // travel preferences
        goal: state.goal,
        level: state.level,
        duration: state.duration,
        transport: state.transport,
        interests: Array.from(state.interests),
      };
      setProfile(profile);
      state.saved = true;
      updateSelectedUI();
      toast("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
    });

    document.getElementById("ppReset")?.addEventListener("click", () => {
      clearProfile();
      loadIntoState(null);
      updateSelectedUI();
      toast("–ü—Ä–æ—Ñ–∏–ª—å —Å–±—Ä–æ—à–µ–Ω");
    });

    document.getElementById("ppClearOnlyInterests")?.addEventListener("click", () => {
      state.interests.clear();
      state.saved = false;
      updateSelectedUI();
      toast("–ò–Ω—Ç–µ—Ä–µ—Å—ã –æ—á–∏—â–µ–Ω—ã");
    });

    // Initial load
    loadIntoState(getProfile());
    updateSelectedUI();
  </script>
</body>
</html>
